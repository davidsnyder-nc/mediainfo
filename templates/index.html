<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .nav-tabs {
            border-bottom: 2px solid #e9ecef;
        }
        .nav-tabs .nav-link {
            border-radius: 8px 8px 0 0;
            margin-right: 4px;
            border: 1px solid transparent;
            color: #6c757d;
            font-weight: 500;
            padding: 12px 20px;
        }
        .nav-tabs .nav-link:hover {
            border-color: #e9ecef #e9ecef #e9ecef;
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            background-color: #fff;
            border-color: #e9ecef #e9ecef #fff;
            color: #0d6efd;
        }
        .tab-content {
            background-color: #fff;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 8px 8px 8px;
            padding: 2rem;
            min-height: 500px;
        }
        .card {
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 12px;
        }
        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        .btn-success {
            background-color: #198754;
            border-color: #198754;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        .btn-outline-primary {
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 12px 16px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected {
            background-color: #198754;
        }
        .status-disconnected {
            background-color: #dc3545;
        }
        .status-unknown {
            background-color: #6c757d;
        }
        .section-header {
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        .icon-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        .config-group {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .alert {
            border-radius: 8px;
            border: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="#">
                <i class="bi bi-collection-play me-2"></i>Media Tracker
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text text-muted">
                    <i class="bi bi-gear me-1"></i>Configuration Panel
                </span>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-11">
                
                <!-- Tab Navigation -->
                <ul class="nav nav-tabs" id="configTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="plex-tab" data-bs-toggle="tab" data-bs-target="#plex" type="button" role="tab">
                            <i class="bi bi-film me-2"></i>Plex
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="sonarr-tab" data-bs-toggle="tab" data-bs-target="#sonarr" type="button" role="tab">
                            <i class="bi bi-tv me-2"></i>Sonarr
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="output-tab" data-bs-toggle="tab" data-bs-target="#output" type="button" role="tab">
                            <i class="bi bi-file-text me-2"></i>Text File
                        </button>
                    </li>

                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="scheduler-tab" data-bs-toggle="tab" data-bs-target="#scheduler" type="button" role="tab">
                            <i class="bi bi-clock me-2"></i>Scheduler
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="actions-tab" data-bs-toggle="tab" data-bs-target="#actions" type="button" role="tab">
                            <i class="bi bi-play-circle me-2"></i>Actions
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab">
                            <i class="bi bi-code-square me-2"></i>API
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="configTabContent">
                    
                    <!-- Plex Tab -->
                    <div class="tab-pane fade show active" id="plex" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-film"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">Plex Media Server</h4>
                                    <p class="text-muted mb-0">Configure your Plex server connection</p>
                                </div>
                            </div>
                        </div>

                        <form id="configForm" method="POST" action="/save_config">
                            <div class="config-group">
                                <h5 class="mb-3">Connection Settings</h5>
                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <label for="plex_url" class="form-label">Plex Server URL</label>
                                        <input type="url" class="form-control" id="plex_url" name="plex_url" 
                                               value="{{ config.plex_url or '' }}" 
                                               placeholder="http://192.168.1.100:32400">
                                        <div class="form-text">Include the full URL with port number</div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Connection Status</label>
                                        <div class="p-3 bg-light rounded">
                                            <span class="status-indicator status-{{ 'connected' if config.plex_url and config.plex_token else 'unknown' }}"></span>
                                            {{ 'Connected' if config.plex_url and config.plex_token else 'Not Configured' }}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <label for="plex_token" class="form-label">Plex Token</label>
                                        <input type="password" class="form-control" id="plex_token" name="plex_token" 
                                               value="{{ config.plex_token or '' }}" 
                                               placeholder="Your Plex authentication token">
                                        <div class="form-text">Get this from your Plex account settings</div>
                                    </div>
                                    <div class="col-md-4 mb-3 d-flex align-items-end">
                                        <button type="button" class="btn btn-outline-primary w-100" onclick="startPlexAuth()">
                                            <i class="bi bi-shield-lock me-2"></i>OAuth Login
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Sonarr Tab -->
                    <div class="tab-pane fade" id="sonarr" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-tv"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">Sonarr</h4>
                                    <p class="text-muted mb-0">Configure your Sonarr instance for TV show tracking</p>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">API Configuration</h5>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="sonarr_url" class="form-label">Sonarr URL</label>
                                    <input type="url" class="form-control" id="sonarr_url" name="sonarr_url" 
                                           value="{{ config.sonarr_url or '' }}" 
                                           placeholder="http://192.168.1.100:8989" form="configForm">
                                    <div class="form-text">Include the full URL with port number</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Connection Status</label>
                                    <div class="p-3 bg-light rounded">
                                        <span class="status-indicator status-{{ 'connected' if config.sonarr_url and config.sonarr_api_key else 'unknown' }}"></span>
                                        {{ 'Connected' if config.sonarr_url and config.sonarr_api_key else 'Not Configured' }}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="sonarr_api_key" class="form-label">API Key</label>
                                <input type="password" class="form-control" id="sonarr_api_key" name="sonarr_api_key" 
                                       value="{{ config.sonarr_api_key or '' }}" 
                                       placeholder="Your Sonarr API key" form="configForm">
                                <div class="form-text">Found in Sonarr → Settings → General → API Key</div>
                            </div>
                        </div>
                    </div>

                    <!-- Output Format Tab -->
                    <div class="tab-pane fade" id="output" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-file-text"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">Text File Output</h4>
                                    <p class="text-muted mb-0">Customize how your media information is formatted in the text file</p>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">File Settings</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="filename" class="form-label">Output Filename</label>
                                    <input type="text" class="form-control" id="filename" name="filename" 
                                           value="{{ config.filename or 'daily_media_report.txt' }}" form="configForm">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="timezone" class="form-label">Timezone</label>
                                    <select class="form-select" id="timezone" name="timezone" form="configForm">
                                        <option value="US/Eastern" {{ 'selected' if config.timezone == 'US/Eastern' else '' }}>Eastern (US/Eastern)</option>
                                        <option value="US/Central" {{ 'selected' if config.timezone == 'US/Central' else '' }}>Central (US/Central)</option>
                                        <option value="US/Mountain" {{ 'selected' if config.timezone == 'US/Mountain' else '' }}>Mountain (US/Mountain)</option>
                                        <option value="US/Pacific" {{ 'selected' if config.timezone == 'US/Pacific' else '' }}>Pacific (US/Pacific)</option>
                                        <option value="UTC" {{ 'selected' if config.timezone == 'UTC' else '' }}>UTC</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">Format Templates</h5>
                            <div class="mb-3">
                                <label for="movie_format" class="form-label">Movie Format</label>
                                <input type="text" class="form-control" id="movie_format" name="movie_format" 
                                       value="{{ config.movie_format or '{title} ({year}) - Added: {added_date}' }}" form="configForm">
                                <div class="form-text">Available variables: {title}, {year}, {added_date}</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="tv_format" class="form-label">TV Show Format</label>
                                <input type="text" class="form-control" id="tv_format" name="tv_format" 
                                       value="{{ config.tv_format or '{title} - Added: {added_date}' }}" form="configForm">
                                <div class="form-text">Available variables: {title}, {added_date}</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="schedule_format" class="form-label">Schedule Format</label>
                                <input type="text" class="form-control" id="schedule_format" name="schedule_format" 
                                       value="{{ config.schedule_format or '{series_title} - S{season:02d}E{episode:02d} - {episode_title} (Airs: {air_date})' }}" form="configForm">
                                <div class="form-text">Available variables: {series_title}, {episode_title}, {season}, {episode}, {air_date}</div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">GitHub Upload (Optional)</h5>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="github_enabled" name="github_enabled" 
                                       {{ 'checked' if config.github_enabled else '' }} form="configForm">
                                <label class="form-check-label" for="github_enabled">
                                    <strong>Upload text file to GitHub repository</strong>
                                </label>
                            </div>

                            <div id="githubSettings" style="{{ 'display: none;' if not config.github_enabled else '' }}">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="github_owner" class="form-label">Repository Owner</label>
                                        <input type="text" class="form-control" id="github_owner" name="github_owner" 
                                               value="{{ config.github_owner or '' }}" 
                                               placeholder="your-username" form="configForm">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="github_repo" class="form-label">Repository Name</label>
                                        <input type="text" class="form-control" id="github_repo" name="github_repo" 
                                               value="{{ config.github_repo or '' }}" 
                                               placeholder="my-repo" form="configForm">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="github_token" class="form-label">Personal Access Token</label>
                                    <input type="password" class="form-control" id="github_token" name="github_token" 
                                           value="{{ config.github_token or '' }}" 
                                           placeholder="ghp_xxxxxxxxxxxx" form="configForm">
                                    <div class="form-text">Create a token with 'repo' permissions at github.com/settings/tokens</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scheduler Tab -->
                    <div class="tab-pane fade" id="scheduler" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-clock"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">Automated Scheduler</h4>
                                    <p class="text-muted mb-0">Schedule automatic media syncing</p>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="scheduler_enabled" name="scheduler_enabled" 
                                       {{ 'checked' if config.scheduler_enabled else '' }} form="configForm">
                                <label class="form-check-label" for="scheduler_enabled">
                                    <strong>Enable Automated Scheduling</strong>
                                </label>
                            </div>

                            <div id="schedulerSettings" style="{{ 'display: none;' if not config.scheduler_enabled else '' }}">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="schedule_type" class="form-label">Schedule Type</label>
                                        <select class="form-select" id="schedule_type" name="schedule_type" form="configForm">
                                            <option value="daily" {{ 'selected' if config.schedule_type == 'daily' else '' }}>Daily</option>
                                            <option value="hourly" {{ 'selected' if config.schedule_type == 'hourly' else '' }}>Hourly</option>
                                        </select>
                                    </div>
                                </div>

                                <div id="dailySchedule" style="{{ 'display: none;' if config.schedule_type == 'hourly' else '' }}">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="schedule_hour" class="form-label">Hour (24h)</label>
                                            <select class="form-select" id="schedule_hour" name="schedule_hour" form="configForm">
                                                {% for hour in range(24) %}
                                                <option value="{{ hour }}" {{ 'selected' if config.schedule_hour == hour else '' }}>{{ '%02d' | format(hour) }}:00</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="schedule_minute" class="form-label">Minute</label>
                                            <select class="form-select" id="schedule_minute" name="schedule_minute" form="configForm">
                                                {% for minute in range(0, 60) %}
                                                <option value="{{ minute }}" {{ 'selected' if config.schedule_minute == minute else '' }}>{{ '%02d' | format(minute) }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div id="hourlySchedule" style="{{ 'display: none;' if config.schedule_type == 'daily' else '' }}">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="schedule_interval" class="form-label">Every X Hours</label>
                                            <select class="form-select" id="schedule_interval" name="schedule_interval" form="configForm">
                                                {% for interval in [1, 2, 3, 4, 6, 8, 12] %}
                                                <option value="{{ interval }}" {{ 'selected' if config.schedule_interval == interval else '' }}>{{ interval }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions Tab -->
                    <div class="tab-pane fade" id="actions" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-play-circle"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">Actions</h4>
                                    <p class="text-muted mb-0">Test connections and run sync operations</p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="config-group">
                                    <h5 class="mb-3">Test Connections</h5>
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-outline-primary" onclick="testConnection()">
                                            <i class="bi bi-wifi me-2"></i>Test All Connections
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="config-group">
                                    <h5 class="mb-3">Manual Sync</h5>
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-success" onclick="runDailySync()">
                                            <i class="bi bi-arrow-repeat me-2"></i>Run Daily Sync
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="config-group mt-4">
                            <h5 class="mb-3 text-danger">Danger Zone</h5>
                            <button type="button" class="btn btn-outline-danger" onclick="clearConfig()">
                                <i class="bi bi-trash me-2"></i>Clear All Configuration
                            </button>
                        </div>
                    </div>

                    <!-- API Documentation Tab -->
                    <div class="tab-pane fade" id="api" role="tabpanel">
                        <div class="section-header">
                            <div class="d-flex align-items-center">
                                <div class="icon-badge">
                                    <i class="bi bi-code-square"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">JSON API Documentation</h4>
                                    <p class="text-muted mb-0">Connect external applications to retrieve media data</p>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">Available Endpoints</h5>
                            <p><strong>Base URL:</strong> <span id="baseUrl">Loading...</span></p>
                            
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><span class="badge bg-success">GET</span> /api/status</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Description:</strong> Get current status of all services</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="testAPI('/api/status')">Test Endpoint</button>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><span class="badge bg-success">GET</span> /api/config</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Description:</strong> Get current configuration settings</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="testAPI('/api/config')">Test Endpoint</button>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><span class="badge bg-success">GET</span> /api/recent</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Description:</strong> Get recently added movies and TV shows</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="testAPI('/api/recent')">Test Endpoint</button>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><span class="badge bg-success">GET</span> /api/schedule</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Description:</strong> Get today's TV schedule from Sonarr</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="testAPI('/api/schedule')">Test Endpoint</button>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><span class="badge bg-success">GET</span> /api/full_sync</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Description:</strong> Get all data in one call</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="testAPI('/api/full_sync')">Test Endpoint</button>
                                </div>
                            </div>
                        </div>

                        <div class="config-group">
                            <h5 class="mb-3">Sample Dashboard</h5>
                            <div class="d-grid gap-2">
                                <a href="/dashboard" target="_blank" class="btn btn-success">
                                    <i class="bi bi-window me-2"></i>View Sample Dashboard
                                </a>
                            </div>
                        </div>

                        <div id="apiResult" class="config-group" style="display: none;">
                            <h5 class="mb-3">Test Result</h5>
                            <div class="alert alert-info">
                                <pre id="apiResponse"></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="bg-white p-3 border-top mt-4">
                    <div class="d-flex justify-content-between">
                        <div id="saveStatus"></div>
                        <button type="submit" form="configForm" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Save Configuration
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function startPlexAuth() {
            window.open('/plex_auth', 'plexAuth', 'width=600,height=600');
        }

        function testConnection() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-arrow-repeat me-2 spinner-border spinner-border-sm"></i>Testing...';
            
            fetch('/test_connection', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    let message = '';
                    if (data.plex) message += 'Plex: ✓ ';
                    else message += 'Plex: ✗ ';
                    if (data.sonarr) message += 'Sonarr: ✓ ';
                    else message += 'Sonarr: ✗ ';
                    if (data.github) message += 'GitHub: ✓';
                    else message += 'GitHub: ✗';
                    
                    document.getElementById('saveStatus').innerHTML = '<div class="alert alert-info">' + message + '</div>';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="bi bi-wifi me-2"></i>Test All Connections';
                });
        }

        function runDailySync() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-arrow-repeat me-2 spinner-border spinner-border-sm"></i>Running...';
            
            fetch('/run_daily_sync', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    const alertType = data.success ? 'alert-success' : 'alert-danger';
                    document.getElementById('saveStatus').innerHTML = '<div class="alert ' + alertType + '">' + data.message + '</div>';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="bi bi-arrow-repeat me-2"></i>Run Daily Sync';
                });
        }

        function clearConfig() {
            if (confirm('Are you sure you want to clear all configuration? This cannot be undone.')) {
                fetch('/clear_config', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();
                        }
                    });
            }
        }

        function testAPI(endpoint) {
            const resultDiv = document.getElementById('apiResult');
            const responseDiv = document.getElementById('apiResponse');
            
            resultDiv.style.display = 'block';
            responseDiv.textContent = 'Loading...';
            
            fetch(endpoint)
                .then(response => response.json())
                .then(data => {
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    responseDiv.textContent = 'Error: ' + error.message;
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const baseUrlElement = document.getElementById('baseUrl');
            if (baseUrlElement) {
                baseUrlElement.textContent = window.location.origin;
            }

            document.getElementById('schedule_type').addEventListener('change', function() {
                const scheduleType = this.value;
                document.getElementById('dailySchedule').style.display = scheduleType === 'daily' ? 'block' : 'none';
                document.getElementById('hourlySchedule').style.display = scheduleType === 'hourly' ? 'block' : 'none';
            });

            document.getElementById('scheduler_enabled').addEventListener('change', function() {
                document.getElementById('schedulerSettings').style.display = this.checked ? 'block' : 'none';
            });

            document.getElementById('github_enabled').addEventListener('change', function() {
                document.getElementById('githubSettings').style.display = this.checked ? 'block' : 'none';
            });

            document.getElementById('configForm').addEventListener('submit', function(e) {
                const btn = this.querySelector('button[type="submit"]');
                btn.disabled = true;
                btn.innerHTML = '<i class="bi bi-arrow-repeat me-2 spinner-border spinner-border-sm"></i>Saving...';
            });
        });
    </script>
</body>
</html>